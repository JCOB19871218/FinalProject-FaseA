<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Professor Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        table { border-collapse: collapse; width: 90%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        button { padding: 5px 10px; margin: 2px; }
        select { margin: 5px 0; padding: 5px; }
    </style>
</head>
<body>

<h2>Professor Dashboard</h2>

<div>
    <h3>Select Course</h3>
    <select id="courseSelect" onchange="loadExams()">
        <option value="">-- Select a course --</option>
    </select>
    <button onclick="window.location.href='/professor/createExample'">Add New Exam</button>
</div>

<h3>Course Exams</h3>
<table>
    <thead>
    <tr>
        <th>Exam ID</th>
        <th>Title</th>
        <th>Description</th>
        <th>Duration</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="examTable"></tbody>
</table>

<script>
    async function loadCourses() {
        try {
            const res = await fetch('/api/professor/courses');
            if (!res.ok) throw new Error(await res.text());

            const courses = await res.json();
            const select = document.getElementById('courseSelect');
            select.innerHTML = '<option value="">-- Select a course --</option>';

            courses.forEach(c => {
                const option = document.createElement('option');
                option.value = c.id;
                option.textContent = c.title;
                select.appendChild(option);
            });
        } catch (err) {
            alert("Error loading courses: " + err.message);
            console.error(err);
        }
    }

    async function loadExams() {
        const courseId = document.getElementById('courseSelect').value;
        if (!courseId) return;

        try {
            const res = await fetch(`/api/professor/exams/course/${courseId}/list`);
            if (!res.ok) throw new Error(await res.text());

            const exams = await res.json();
            const tbody = document.getElementById('examTable');
            tbody.innerHTML = "";

            exams.forEach(e => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${e.id}</td>
                    <td>${e.title}</td>
                    <td>${e.description || ""}</td>
                    <td>${e.duration || ""}</td>
                    <td>
                        <button onclick="editExam(${e.id})">Edit</button>
                        <button onclick="deleteExam(${e.id})">Delete</button>
                        <button onclick="openQuestionModal(${e.id})">Add Question</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

        } catch (err) {
            alert("Error loading exams: " + err.message);
        }
    }

    async function editExam(examId) {
        const title = prompt("New title:");
        const description = prompt("New description:");
        const duration = prompt("New duration:");
        if (!title || !description || !duration) return;

        const dto = { title, description, duration: parseInt(duration, 10) };
        const res = await fetch(`/api/professor/exams/${examId}/update`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dto)
        });

        if (!res.ok) { alert(await res.text()); return; }
        loadExams();
    }

    async function deleteExam(examId) {
        if (!confirm("Delete this exam?")) return;
        const res = await fetch(`/api/professor/exams/${examId}/delete`, { method: "DELETE" });
        if (!res.ok) { alert(await res.text()); return; }
        loadExams();
    }

    function openQuestionModal(examId) {
        alert("Open question modal for exam " + examId);
    }

    loadCourses();
</script>

</body>
</html>
